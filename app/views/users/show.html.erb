<div class="body_wrap"></div>
<div class="aside__menu">
  <ul class="aside__menu_lists">
    <li class="aside__menu_list aside__menu_close">閉じる</li>
    <li class="aside__menu_list">
      <%= link_to "新規サークル登録", new_circle_path, class: "create_circle_btn"%>
    </li>
    <li class="aside__menu_list"><%= link_to "ログアウト", logout_path, method: :delete %></li>
  </ul>
</div>

<header class="header">
  <div class="header__background"></div>
  <%= form_for(@user, html: { multipart: true }) do |f| %>
    <div class="header__photo_user" style="background-image: url(<%= @user.picture %>);">
      <%= f.file_field :picture, id: "user_picture", accept: 'image/jpeg,image/gif,image/png' %>
    </div>
    <div style="
      position: relative;
      width: 50%;
      margin: 0 auto;
    ">
      <%= f.submit "更新", class: "submit",
        style: "
          position: absolute;
          z-index: 202;
          top: 60vh;
          width: 100%;
          display: none;
          "
        %>
      </div>
  <% end %>
  <h1 class="header__name_user"><%= @user.name %></h1>
  <p class="header__subhead_user"><%= %>meiji univ. tokyo</p>
  <% if current_user?(@user) %>
    <%= image_tag "menu.svg" , class: "header__menu_humberger" %>
  <% end %>
  <%= image_tag "foot.png" , class: "header__foot" %>
  <% if !current_user?(@user) %>
    <div class="buttun buttun_follow butttun_color_white">
      <div id="follow_form">
        <% if !current_user.following?(@user) %>
          <%= render 'follow' %>
        <% else %>
          <%= render 'unfollow' %>
        <% end %>
      </div>
    </div>
  <% end %>
</header>
<script type="text/javascript">
  $(function(){
    $('#user_picture').on('change', function(){
      var cover = $('<div>').css({
        width: '100%',
        height: '100vh',
        backgroundColor: 'rgba(0, 0, 0, 0.7)',
        position: 'fixed',
        zIndex: '201',
        textAlign: 'center'
      });
      var cross = "<%= asset_path "cross.png" %>";
      cover.append($('<div>').css({
        position: 'absolute',
        width: '50px',
        height: '50px',
        top: '0',
        right: '0',
        backgroundImage: 'url(' + cross + ')',
        backgroundSize: 'cover',
                                }).addClass(
        'close_btn'
      ));
      $('nav').before(cover);
      $('.close_btn').on('click', function(){
        cover.remove();
        $('.submit').css('display', 'none');
      });
      $('.submit').css('display', 'inline-block');

      var file = $(this).prop('files')[0];
      var reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = function(e) {
        cover.append($('<div>').css({
          width: '250px',
          height: '250px',
          margin: '40% auto',
          backgroundPosition: '50%',
          backgroundImage: "url(" + e.target.result + ")",
          backgroundSize: 'cover',
          backgroundRepeat: 'no-repeat',
          border: '1px solid #000',
          borderRadius: '50%',
        }));
      };
    });

  });

  $('#user_picture').bind('change', function() {
    var size_in_megabytes = this.files[0].size/1024/1024;
    if (size_in_megabytes > 5) {
      alert('Maximum file size is 5MB. Please choose a smaller file.');
    }
  });
</script>

<div class="follow">
  <ul class="follow__wrap">
    <li class="follow__list">
      <%= link_to [:following, @user] , class: "follow__link" do %>
        <span id="following_count" class="follow__number" ><%= @user.following.count %></span>フォロー
      <% end %>
    </li>
    <li class="follow__list">
      <%= link_to [:followers, @user] , class: "follow__link" do %>
      <span id="followers_count" class="follow__number" >
      <%= @user.followers.count %></span>フォロワー
      <% end %>
    </li>
    <li class="follow__list">
      <%= link_to @user.favorites.count.to_s+" お気に入り", [:favorites, @user],calss: "follow__link" %>
    </li>
  </ul>
</div>

<section class="user__body">
  <div class="introduce">
    <h1 class="introduce__heading">自己紹介</h1>
    <p class="introduce__text"><%= @user.introduce %></p>
    <% if current_user?(@user) %>
    <div class="introduce__btn">
      <%= link_to '編集', edit_user_path(current_user, edit_item: "introduce"), class: "buttun buttun_size_small buttun_color_white" %>
    </div>
    <% end %>
  </div>

  <div class="introduce">
    <h1 class="introduce__heading">やりたいこと</h1>
    <p class="introduce__text"><%= @user.want_to_do %></p>
    <% if current_user?(@user) %>
    <div class="introduce__btn">
      <%= link_to '編集', edit_user_path(current_user, edit_item: "want_to_do"), class: "buttun buttun_size_small buttun_color_white" %>
    </div>
    <% end %>
  </div>

  <div class="introduce">
    <h1 class="introduce__heading">趣味</h1>
    <p class="introduce__text"><%= @user.hobby %></p>
    <% if current_user?(@user) %>
    <div class="introduce__btn">
      <%= link_to '編集', edit_user_path(current_user, edit_item: "hobby"), class: "buttun buttun_size_small buttun_color_white" %>
    </div>
    <% end %>
  </div>

</section>